{% extends 'base.html.twig' %}

{% block title %}Pixel Combat RPG{% endblock %}

{% block body %}
<div class="scanlines"></div>

<div class="pixel-container"
     data-controller="battle"
     data-battle-battle-url-value="{{ path('battle_tick') }}"
     data-battle-char1-hp-value="{{ battleState.char1.hp }}"
     data-battle-char2-hp-value="{{ battleState.char2.hp }}">



    
    <div class="battle-screen pixel-border">
    <div class="flex" >
    
{% for charKey, char in {'char1': battleState.char1, 'char2': battleState.char2} %}
    
 
                            <div class="character-info" >
                        <div class="character-name">{{ char.name }}</div>

                        <!-- Barre de vie -->
                        <div class="health-label">
                            <span>HP</span>
                            <span id="hp-{{ charKey }}-text">{{ char.hp }}/100</span>
                        </div>
                        <div class="health-bar-container">
                            {% set hpRatio = (char.hp / 100) * 100 %}
                            <div class="health-bar" id="health-bar-{{ charKey }}" style="width: {{ hpRatio }}%;">
                                <div class="health-text">{{ char.hp }}/100</div>
                            </div>
                        </div>

                        <!-- Barre de stamina -->
                        <div class="stamina-label">
                            <span>Stamina</span>
                        </div>
                        <div class="stamina-bar-container">
                            {% set staminaRatio = (char.stamina / 100) * 100 %}
                            <div class="stamina-bar" id="stamina-bar-{{ charKey }}" style="width: {{ staminaRatio }}%;">
                                <span id="stamina-{{ charKey }}-text">{{ char.stamina }}/100</span>
                            </div>
                        </div>

                        <!-- Statistiques -->
                        <div class="stats-grid">
                            {% for stat, value in {'strength': char.strength, 'speed': char.speed, 'agility': char.agility, 'defense': char.defense} %}
                                <div class="stat-box">
                                    <div class="stat-value">{{ value }}</div>
                                    <div class="stat-name">{{ stat|upper }}</div>
                                </div>
                            {% endfor %}
                        </div>
                    </div>
                    
                      {% endfor %}
                      
                      </div>
        <div class="battle-grid"></div>
        
        <!-- Animation de poussière pixelisée -->
        <div id="pixel-dust-container"></div>

        <!-- Message de fin de jeu -->
        <div class="game-over" id="game-over">
            <div class="game-over-title">Game Over</div>
            <div class="winner-name" id="winner-name">Player 1 Wins!</div>
        </div>

        <!-- Interface de pause entre les rounds -->
        <div class="round-pause" id="round-pause" 
             style="display: none"
             data-controller="inventory"
             data-inventory-battle-url-value="{{ path('battle_tick') }}"
             data-inventory-inventory-url-value="{{ path('battle_inventory', { 'characterKey': battleState.char1.key }) }}"
             data-inventory-equip-url-value="{{ path('battle_equip_perk', { 'characterKey': battleState.char1.key, 'slotId': 0, 'perkId': 0 }) }}"
             data-inventory-ready-url-value="{{ path('battle_ready', { 'characterKey': battleState.char1.key }) }}"
             data-inventory-character-key-value="{{ battleState.char1.key }}">

            <div class="round-pause-content pixel-border">
                <h2 id="round-number" class="round-title">Round terminé</h2>
                <p id="pause-instructions" class="pause-text">Équipez vos objets et préparez-vous pour le prochain round !</p>
                
                <div class="pause-buttons">
                    <button id="btn-inventory" class="pixel-button">INVENTAIRE</button>
                    <button id="btn-ready" class="pixel-button">PRÊT</button>
                </div>
            </div>
            
            <!-- Panneau d'inventaire -->
            <div id="inventory-panel" class="inventory-panel pixel-border" style="display: none;">
                <div class="inventory-header">
                    <h3>INVENTAIRE</h3>
                    <button id="btn-close-inventory" class="pixel-button small">X</button>
                </div>
                <div class="inventory-content">
                    <div class="inventory-section">
                        <h4 class="section-title">Perks disponibles</h4>
                        <div id="perks-list" class="perks-list"></div>
                    </div>
                    <div class="inventory-section">
                        <h4 class="section-title">Slots d'équipement</h4>
                        <div id="perk-slots" class="perk-slots"></div>
                    </div>
                </div>
            </div>
        </div>
       <div class="battle-controls" id="battle-controls">
            <button class="pixel-button btn-start" id="btn-start">START</button>
            <button class="pixel-button btn-pause" id="btn-pause" style="display: none;">PAUSE</button>
        </div>
        <div class="battle-arena">
            {% for charKey, char in {'char1': battleState.char1, 'char2': battleState.char2} %}
                <div class="{{ charKey }}" id="{{ charKey }}-panel">
                    <div class="active-turn" id="turn-{{ charKey }}">TOUR</div>
                     <div class="character-sprite ">
                     <img src="/images/character_solo.png" alt="{{ char.name }}" class="character-image">
                        <div class="sprite-placeholder">{{ char.name|slice(0, 1) }}</div>
                    </div>

                    <div class="damage-effect" id="damage-{{ charKey }}">-10</div>
                </div>
            {% endfor %}
        </div>
        <!-- Contrôles de combat -->
       
    </div>

    <!-- Logs du combat -->

</div>
    <div class="battle-log pixel-border">
        <div class="log-header">
            <div class="log-title">COMBAT LOG</div>
            <div class="turn-counter" id="turn-counter">TURN 1</div>
        </div>
        <div class="log-messages" id="log-messages">
            {% for log in battleState.logs %}
                <div class="log-message log-system">{{ log }}</div>
            {% endfor %}
        </div>
    </div>
{% endblock %}
