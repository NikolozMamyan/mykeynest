{% extends 'base_auth.html.twig' %}

{% block title %}{{ article.title }} | Centre d'aide | MykeyNest{% endblock %}

{% block meta_description %}
<meta name="description" content="{{ article.excerpt }}">
<meta property="og:title" content="{{ article.title }} | MykeyNest">
<meta property="og:description" content="{{ article.excerpt }}">
<meta property="og:type" content="article">
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=DM+Sans:ital,wght@0,400;0,500;0,700;1,400&family=Space+Mono:wght@400;700&family=Lora:ital,wght@0,400;0,600;1,400&display=swap" rel="stylesheet">
{% endblock %}

{#
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
CONTROLLER ‚Äî exemple de donn√©es √† passer :

$article = [
    'slug'        => 'zero-knowledge-explique',
    'title'       => "Qu'est-ce que l'architecture zero-knowledge ?",
    'excerpt'     => "D√©couvrez comment MykeyNest garantit que personne, m√™me nous, ne peut lire vos mots de passe.",
    'readTime'    => 4,
    'updatedAt'   => new \DateTime('2026-01-15'),
    'author'      => '√âquipe MykeyNest',
    'popular'     => true,
    'tags'        => ['s√©curit√©', 'chiffrement', 'architecture'],
    'helpfulYes'  => 142,   // compteur votes positifs
    'helpfulNo'   => 8,     // compteur votes n√©gatifs
    'sections'    => [      // sections du contenu
        [
            'id'      => 'intro',
            'title'   => 'Introduction',
            'content' => '<p>Le chiffrement zero-knowledge signifie...</p>',
        ],
        [
            'id'      => 'comment-ca-marche',
            'title'   => 'Comment √ßa marche ?',
            'content' => '<p>Lorsque vous cr√©ez votre compte...</p><ul><li>...</li></ul>',
        ],
    ],
];

$category = [
    'slug'  => 'securite',
    'icon'  => 'üîê',
    'title' => 'S√©curit√© & Chiffrement',
];

$relatedArticles = [
    [
        'slug'     => 'aes-256-explique',
        'title'    => 'Comment fonctionne le chiffrement AES-256 ?',
        'excerpt'  => 'Plongez dans les d√©tails du standard de chiffrement utilis√© par MykeyNest.',
        'readTime' => 5,
    ],
    ...
];
‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ
#}

{% block body %}
<style>
    :root {
        --color-primary: #059669;
        --color-primary-hover: rgba(16,185,129,0.15);
        --color-white: #ffffff;
        --color-bg-light: #f8fafc;
        --color-bg-hover: #f1f5f9;
        --color-text-dark: #1e293b;
        --color-text-medium: #475569;
        --color-text-muted: #64748b;
        --color-text-light: #94a3b8;
        --color-border: #e2e8f0;
        --color-success: #10b981;
        --shadow-sm: 0 1px 3px rgba(0,0,0,0.05);
        --shadow-green: 0 4px 14px rgba(5,150,105,0.18);
        --shadow-md: 0 4px 6px -1px rgba(0,0,0,0.1),0 2px 4px -1px rgba(0,0,0,0.06);
        --shadow-lg: 0 10px 15px -3px rgba(0,0,0,0.1),0 4px 6px -2px rgba(0,0,0,0.05);
        --shadow-xl: 0 20px 25px -5px rgba(0,0,0,0.1),0 10px 10px -5px rgba(0,0,0,0.04);
        --border-radius: 12px;
        --border-radius-sm: 8px;
    }

    *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }
    body { font-family: 'DM Sans', sans-serif; background: #f8fafc; color: var(--color-text-dark); }

    /* ‚îÄ‚îÄ Reading progress bar ‚îÄ‚îÄ */
    .art-progress-bar {
        position: fixed;
        top: 0;
        left: 0;
        height: 3px;
        width: 0%;
        background: linear-gradient(90deg, var(--color-primary), #10b981);
        z-index: 9999;
        transition: width 0.1s linear;
    }

    /* ‚îÄ‚îÄ Breadcrumb ‚îÄ‚îÄ */
    .art-breadcrumb {
        background: var(--color-white);
        border-bottom: 1px solid var(--color-border);
        padding: 0.875rem 2rem;
        position: sticky;
        top: 0;
        z-index: 100;
        backdrop-filter: blur(8px);
        background: rgba(255,255,255,0.95);
    }

    .art-breadcrumb-inner {
        max-width: 1200px;
        margin: 0 auto;
        display: flex;
        align-items: center;
        justify-content: space-between;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .art-breadcrumb-nav {
        display: flex;
        align-items: center;
        gap: 0.5rem;
        flex-wrap: wrap;
    }

    .art-breadcrumb-nav a {
        font-size: 0.8125rem;
        color: var(--color-text-muted);
        text-decoration: none;
        font-weight: 500;
        transition: color 0.2s;
        display: flex;
        align-items: center;
        gap: 0.3rem;
    }

    .art-breadcrumb-nav a:hover { color: var(--color-primary); }

    .art-breadcrumb-sep { color: var(--color-text-light); font-size: 0.75rem; }

    .art-breadcrumb-current {
        font-size: 0.8125rem;
        color: var(--color-text-dark);
        font-weight: 600;
        max-width: 300px;
        white-space: nowrap;
        overflow: hidden;
        text-overflow: ellipsis;
    }

    .art-breadcrumb-readtime {
        display: flex;
        align-items: center;
        gap: 0.35rem;
        font-size: 0.75rem;
        color: var(--color-text-muted);
        white-space: nowrap;
    }

    /* ‚îÄ‚îÄ Layout ‚îÄ‚îÄ */
    .art-layout {
        max-width: 1200px;
        margin: 0 auto;
        padding: 3rem 2rem 5rem;
        display: grid;
        grid-template-columns: 220px 1fr 240px;
        gap: 3rem;
        align-items: start;
    }

    /* ‚îÄ‚îÄ Left TOC ‚îÄ‚îÄ */
    .art-toc {
        position: sticky;
        top: 5rem;
    }

    .art-toc-title {
        font-size: 0.6875rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--color-text-muted);
        margin-bottom: 0.875rem;
    }

    .art-toc-list { list-style: none; display: flex; flex-direction: column; gap: 0.125rem; }

    .art-toc-link {
        display: block;
        font-size: 0.8125rem;
        font-weight: 500;
        color: var(--color-text-muted);
        text-decoration: none;
        padding: 0.375rem 0.75rem;
        border-left: 2px solid var(--color-border);
        transition: all 0.2s;
        border-radius: 0 4px 4px 0;
    }

    .art-toc-link:hover {
        color: var(--color-primary);
        border-left-color: var(--color-primary);
        background: var(--color-primary-hover);
    }

    .art-toc-link.active {
        color: var(--color-primary);
        border-left-color: var(--color-primary);
        background: var(--color-primary-hover);
        font-weight: 700;
    }

    /* ‚îÄ‚îÄ Article main ‚îÄ‚îÄ */
    .art-main {}

    /* ‚îÄ‚îÄ Article header ‚îÄ‚îÄ */
    .art-header {
        background: var(--color-white);
        border: 1.5px solid var(--color-border);
        border-radius: var(--border-radius);
        padding: 2.5rem;
        margin-bottom: 1.5rem;
        animation: artIn 0.5s ease-out both;
    }

    @keyframes artIn {
        from { opacity:0; transform:translateY(16px); }
        to   { opacity:1; transform:translateY(0); }
    }

    .art-header-tags {
        display: flex;
        gap: 0.4rem;
        flex-wrap: wrap;
        margin-bottom: 1rem;
    }

    .art-tag {
        font-size: 0.6875rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.05em;
        color: var(--color-primary);
        background: #f0fdf4;
        border: 1px solid rgba(5,150,105,0.2);
        padding: 0.2rem 0.625rem;
        border-radius: 2rem;
    }

    .art-tag-popular {
        color: #b45309;
        background: #fffbeb;
        border-color: rgba(180,83,9,0.2);
    }

    .art-header h1 {
        font-family: 'Lora', Georgia, serif;
        font-size: clamp(1.5rem, 3vw, 2.125rem);
        font-weight: 600;
        color: var(--color-text-dark);
        line-height: 1.3;
        margin-bottom: 1rem;
    }

    .art-header-excerpt {
        font-size: 1.0625rem;
        color: var(--color-text-medium);
        line-height: 1.65;
        margin-bottom: 1.5rem;
    }

    .art-header-meta {
        display: flex;
        align-items: center;
        gap: 1.5rem;
        flex-wrap: wrap;
        padding-top: 1.25rem;
        border-top: 1px solid var(--color-border);
    }

    .art-meta-item {
        display: flex;
        align-items: center;
        gap: 0.375rem;
        font-size: 0.8125rem;
        color: var(--color-text-muted);
        font-weight: 500;
    }

    .art-meta-item svg { width: 0.9375rem; height: 0.9375rem; }

    /* ‚îÄ‚îÄ Article body content ‚îÄ‚îÄ */
    .art-body-card {
        background: var(--color-white);
        border: 1.5px solid var(--color-border);
        border-radius: var(--border-radius);
        padding: 2.5rem;
        margin-bottom: 1.5rem;
        animation: artIn 0.5s ease-out 0.1s both;
    }

    /* Typography for the article content */
    .art-content { font-family: 'DM Sans', sans-serif; }

    .art-content .art-section { margin-bottom: 2.5rem; }
    .art-content .art-section:last-child { margin-bottom: 0; }

    .art-content h2 {
        font-family: 'Lora', Georgia, serif;
        font-size: 1.375rem;
        font-weight: 600;
        color: var(--color-text-dark);
        margin-bottom: 1rem;
        padding-bottom: 0.625rem;
        border-bottom: 2px solid #f0fdf4;
        display: flex;
        align-items: center;
        gap: 0.5rem;
    }

    .art-content h2::before {
        content: '';
        display: block;
        width: 4px;
        height: 1.25rem;
        background: linear-gradient(180deg, var(--color-primary), #10b981);
        border-radius: 2px;
        flex-shrink: 0;
    }

    .art-content p {
        font-size: 1rem;
        color: var(--color-text-medium);
        line-height: 1.75;
        margin-bottom: 1rem;
    }

    .art-content p:last-child { margin-bottom: 0; }

    .art-content ul, .art-content ol {
        padding-left: 1.25rem;
        margin-bottom: 1rem;
        display: flex;
        flex-direction: column;
        gap: 0.5rem;
    }

    .art-content li {
        font-size: 1rem;
        color: var(--color-text-medium);
        line-height: 1.65;
    }

    .art-content strong { color: var(--color-text-dark); font-weight: 700; }
    .art-content em { font-style: italic; }

    .art-content code {
        font-family: 'Space Mono', monospace;
        font-size: 0.8125rem;
        background: #f0fdf4;
        color: var(--color-primary);
        padding: 0.15rem 0.4rem;
        border-radius: 4px;
        border: 1px solid rgba(5,150,105,0.15);
    }

    /* Callout / info box */
    .art-callout {
        background: #f0fdf4;
        border: 1px solid rgba(5,150,105,0.25);
        border-left: 4px solid var(--color-primary);
        border-radius: 0 var(--border-radius-sm) var(--border-radius-sm) 0;
        padding: 1rem 1.25rem;
        margin: 1.25rem 0;
        display: flex;
        gap: 0.75rem;
        align-items: flex-start;
    }

    .art-callout-icon { font-size: 1.125rem; flex-shrink: 0; margin-top: 1px; }

    .art-callout-text {
        font-size: 0.9rem;
        color: var(--color-text-medium);
        line-height: 1.6;
    }

    .art-callout-text strong { color: var(--color-text-dark); }

    /* Warning callout */
    .art-callout-warn {
        background: #fffbeb;
        border-color: rgba(245,158,11,0.25);
        border-left-color: #f59e0b;
    }

    /* ‚îÄ‚îÄ Like / Dislike widget ‚îÄ‚îÄ */
    .art-helpful-card {
        background: var(--color-white);
        border: 1.5px solid var(--color-border);
        border-radius: var(--border-radius);
        padding: 2rem 2.5rem;
        text-align: center;
        margin-bottom: 1.5rem;
        animation: artIn 0.5s ease-out 0.2s both;
    }

    .art-helpful-label {
        font-size: 1rem;
        font-weight: 700;
        color: var(--color-text-dark);
        margin-bottom: 0.375rem;
    }

    .art-helpful-sub {
        font-size: 0.875rem;
        color: var(--color-text-muted);
        margin-bottom: 1.5rem;
    }

    .art-helpful-actions {
        display: flex;
        justify-content: center;
        gap: 1rem;
        flex-wrap: wrap;
    }

    .art-helpful-btn {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        padding: 0.75rem 1.75rem;
        border-radius: var(--border-radius-sm);
        font-size: 0.9375rem;
        font-weight: 700;
        cursor: pointer;
        border: 2px solid var(--color-border);
        background: var(--color-white);
        color: var(--color-text-dark);
        font-family: 'DM Sans', sans-serif;
        transition: all 0.25s cubic-bezier(0.4,0,0.2,1);
        position: relative;
        overflow: hidden;
    }

    .art-helpful-btn svg { width: 1.25rem; height: 1.25rem; transition: transform 0.3s; }

    .art-helpful-btn:hover { transform: translateY(-2px); box-shadow: var(--shadow-md); }

    .art-helpful-btn-yes:hover {
        border-color: var(--color-primary);
        background: #f0fdf4;
        color: var(--color-primary);
    }

    .art-helpful-btn-yes:hover svg { transform: translateY(-3px); }

    .art-helpful-btn-no:hover {
        border-color: #ef4444;
        background: #fef2f2;
        color: #ef4444;
    }

    .art-helpful-btn-no:hover svg { transform: translateY(3px); }

    /* Voted states */
    .art-helpful-btn.voted-yes {
        border-color: var(--color-primary);
        background: linear-gradient(135deg, #f0fdf4, #ecfdf5);
        color: var(--color-primary);
        cursor: default;
        pointer-events: none;
    }

    .art-helpful-btn.voted-no {
        border-color: #ef4444;
        background: #fef2f2;
        color: #ef4444;
        cursor: default;
        pointer-events: none;
    }

    .art-helpful-count {
        font-family: 'Space Mono', monospace;
        font-size: 0.75rem;
        background: var(--color-bg-light);
        padding: 0.1rem 0.45rem;
        border-radius: 2rem;
    }

    .art-helpful-thank {
        display: none;
        margin-top: 1.25rem;
        padding: 0.75rem 1.25rem;
        background: #f0fdf4;
        border: 1px solid rgba(5,150,105,0.2);
        border-radius: var(--border-radius-sm);
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--color-primary);
        animation: thankIn 0.4s cubic-bezier(0.34,1.56,0.64,1) both;
    }

    @keyframes thankIn {
        from { opacity:0; transform: scale(0.92); }
        to   { opacity:1; transform: scale(1); }
    }

    /* ‚îÄ‚îÄ Right sidebar ‚îÄ‚îÄ */
    .art-sidebar { position: sticky; top: 5rem; display: flex; flex-direction: column; gap: 1.25rem; }

    .art-sidebar-card {
        background: var(--color-white);
        border: 1.5px solid var(--color-border);
        border-radius: var(--border-radius);
        padding: 1.5rem;
        transition: border-color 0.2s, box-shadow 0.2s;
    }

    .art-sidebar-card:hover { border-color: rgba(5,150,105,0.3); box-shadow: var(--shadow-green); }

    .art-sidebar-title {
        font-size: 0.6875rem;
        font-weight: 700;
        text-transform: uppercase;
        letter-spacing: 0.1em;
        color: var(--color-primary);
        margin-bottom: 1rem;
        display: flex;
        align-items: center;
        gap: 0.4rem;
    }

    /* Related articles */
    .art-related-list { display: flex; flex-direction: column; gap: 0; }

    .art-related-link {
        display: flex;
        align-items: flex-start;
        gap: 0.625rem;
        padding: 0.75rem 0;
        border-bottom: 1px solid var(--color-border);
        text-decoration: none;
        transition: all 0.2s;
    }

    .art-related-link:last-child { border-bottom: none; padding-bottom: 0; }

    .art-related-link:hover { padding-left: 4px; }

    .art-related-dot {
        width: 0.4rem;
        height: 0.4rem;
        background: var(--color-primary);
        border-radius: 50%;
        flex-shrink: 0;
        margin-top: 0.45rem;
    }

    .art-related-info {}

    .art-related-title {
        font-size: 0.8125rem;
        font-weight: 600;
        color: var(--color-text-dark);
        line-height: 1.4;
        margin-bottom: 0.2rem;
        transition: color 0.2s;
    }

    .art-related-link:hover .art-related-title { color: var(--color-primary); }

    .art-related-time {
        font-size: 0.6875rem;
        color: var(--color-text-muted);
        display: flex;
        align-items: center;
        gap: 0.25rem;
    }

    /* Share */
    .art-share-btns { display: flex; gap: 0.5rem; }

    .art-share-btn {
        flex: 1;
        padding: 0.55rem;
        border-radius: var(--border-radius-sm);
        border: 1.5px solid var(--color-border);
        background: var(--color-white);
        cursor: pointer;
        font-size: 0.8125rem;
        font-weight: 600;
        color: var(--color-text-medium);
        font-family: 'DM Sans', sans-serif;
        transition: all 0.2s;
        display: flex;
        align-items: center;
        justify-content: center;
        gap: 0.35rem;
        text-decoration: none;
    }

    .art-share-btn svg { width: 1rem; height: 1rem; }

    .art-share-btn:hover {
        border-color: var(--color-primary);
        background: #f0fdf4;
        color: var(--color-primary);
        transform: translateY(-1px);
    }

    /* Contact CTA in sidebar */
    .art-sidebar-cta {
        background: linear-gradient(135deg, var(--color-primary), #10b981);
        border: none;
        text-align: center;
        padding: 1.75rem 1.25rem;
    }

    .art-sidebar-cta:hover { box-shadow: var(--shadow-green); border-color: transparent; }

    .art-sidebar-cta-icon {
        font-size: 1.75rem;
        margin-bottom: 0.625rem;
    }

    .art-sidebar-cta h3 {
        font-size: 0.9375rem;
        font-weight: 700;
        color: white;
        margin-bottom: 0.4rem;
    }

    .art-sidebar-cta p {
        font-size: 0.8rem;
        color: rgba(255,255,255,0.85);
        margin-bottom: 1.1rem;
        line-height: 1.5;
    }

    .art-sidebar-cta a {
        display: inline-flex;
        align-items: center;
        gap: 0.4rem;
        padding: 0.55rem 1.25rem;
        background: white;
        color: var(--color-primary);
        border-radius: var(--border-radius-sm);
        font-size: 0.8125rem;
        font-weight: 700;
        text-decoration: none;
        transition: all 0.25s;
        box-shadow: var(--shadow-sm);
    }

    .art-sidebar-cta a:hover { transform: translateY(-2px); box-shadow: var(--shadow-lg); }

    /* ‚îÄ‚îÄ Back to category ‚îÄ‚îÄ */
    .art-back-link {
        display: inline-flex;
        align-items: center;
        gap: 0.5rem;
        font-size: 0.875rem;
        font-weight: 600;
        color: var(--color-text-muted);
        text-decoration: none;
        margin-bottom: 2rem;
        transition: color 0.2s;
    }

    .art-back-link svg { width: 1rem; height: 1rem; transition: transform 0.2s; }
    .art-back-link:hover { color: var(--color-primary); }
    .art-back-link:hover svg { transform: translateX(-3px); }

    /* ‚îÄ‚îÄ Responsive ‚îÄ‚îÄ */
    @media (max-width: 1060px) {
        .art-layout { grid-template-columns: 1fr 240px; }
        .art-toc { display: none; }
    }

    @media (max-width: 760px) {
        .art-layout { grid-template-columns: 1fr; padding: 1.5rem 1.25rem 4rem; gap: 1.5rem; }
        .art-sidebar { position: static; }
        .art-header, .art-body-card { padding: 1.5rem; }
        .art-helpful-card { padding: 1.5rem; }
        .art-breadcrumb-readtime { display: none; }
    }
</style>

{# Reading progress bar #}
<div class="art-progress-bar" id="artProgress" role="progressbar" aria-valuemin="0" aria-valuemax="100"></div>

<main>

    {# ‚îÄ‚îÄ Breadcrumb (sticky) ‚îÄ‚îÄ #}
    <nav class="art-breadcrumb" aria-label="{{ 'help_article.breadcrumb.aria'|trans }}">
        <div class="art-breadcrumb-inner">
            <div class="art-breadcrumb-nav">
                <a href="{{ path('app_help_center') }}">
                    <svg width="13" height="13" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M3 12l2-2m0 0l7-7 7 7M5 10v10a1 1 0 001 1h3m10-11l2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/>
                    </svg>
                    {{ 'help_article.breadcrumb.help_center'|trans }}
                </a>

                <span class="art-breadcrumb-sep">‚Ä∫</span>

                <a href="{{ path('app_help_category', { slug: category.slug }) }}">
                    {{ category.icon }} {{ category.title }}
                </a>

                <span class="art-breadcrumb-sep">‚Ä∫</span>
                <span class="art-breadcrumb-current">{{ article.title }}</span>
            </div>

            <div class="art-breadcrumb-readtime">
                <svg width="13" height="13" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                          d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                </svg>
                {{ 'help_article.meta.read_time'|trans({ minutes: article.readTime }) }}
            </div>
        </div>
    </nav>

    {# ‚îÄ‚îÄ Layout ‚îÄ‚îÄ #}
    <div class="art-layout">

        {# ‚îÄ‚îÄ Left TOC ‚îÄ‚îÄ #}
        <nav class="art-toc" aria-label="{{ 'help_article.toc.aria'|trans }}">
            <p class="art-toc-title">{{ 'help_article.toc.title'|trans }}</p>
            <ul class="art-toc-list">
                {% for section in article.sections %}
                    <li>
                        <a href="#{{ section.id }}" class="art-toc-link" data-toc="{{ section.id }}">
                            {{ section.title }}
                        </a>
                    </li>
                {% endfor %}
            </ul>
        </nav>

        {# ‚îÄ‚îÄ Main article ‚îÄ‚îÄ #}
        <div>
            {# Back link #}
            <a href="{{ path('app_help_category', { slug: category.slug }) }}" class="art-back-link">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
                </svg>
                {{ 'help_article.back.to_category'|trans({ category: category.title }) }}
            </a>

            {# Article header #}
            <header class="art-header">
                <div class="art-header-tags">
                    {% if article.popular %}
                        <span class="art-tag art-tag-popular">{{ 'help_article.tags.popular'|trans }}</span>
                    {% endif %}
                    {% for tag in article.tags %}
                        <span class="art-tag">{{ tag }}</span>
                    {% endfor %}
                </div>

                <h1>{{ article.title }}</h1>
                <p class="art-header-excerpt">{{ article.excerpt }}</p>

                <div class="art-header-meta">
                    <span class="art-meta-item">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                        </svg>
                        {{ article.author }}
                    </span>

                    <span class="art-meta-item">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        {{ 'help_article.meta.updated_on'|trans({ date: article.updatedAt|date('d/m/Y') }) }}
                    </span>

                    <span class="art-meta-item">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        {{ 'help_article.meta.read_time'|trans({ minutes: article.readTime }) }}
                    </span>
                </div>
            </header>

            {# Article body #}
            <article class="art-body-card" id="artContent">
                <div class="art-content">
                    {% for section in article.sections %}
                        <div class="art-section" id="{{ section.id }}">
                            <h2>{{ section.title }}</h2>
                            {{ section.content|raw }}
                        </div>
                    {% endfor %}
                </div>
            </article>

            {# ‚îÄ‚îÄ Like / Dislike ‚îÄ‚îÄ #}
            <div class="art-helpful-card" id="artHelpfulCard"
                 data-article="{{ article.slug }}"
                 data-yes="{{ article.helpfulYes }}"
                 data-no="{{ article.helpfulNo }}">

                <p class="art-helpful-label">{{ 'help_article.helpful.question'|trans }}</p>
                <p class="art-helpful-sub">{{ 'help_article.helpful.sub'|trans }}</p>

                <div class="art-helpful-actions">
                    <button class="art-helpful-btn art-helpful-btn-yes" id="btnHelpYes" aria-label="{{ 'help_article.helpful.yes_aria'|trans }}">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M14 10h4.764a2 2 0 011.789 2.894l-3.5 7A2 2 0 0115.263 21h-4.017c-.163 0-.326-.02-.485-.06L7 20m7-10V5a2 2 0 00-2-2h-.095c-.5 0-.905.405-.905.905 0 .714-.211 1.412-.608 2.006L7 11v9m7-10h-2M7 20H5a2 2 0 01-2-2v-6a2 2 0 012-2h2.5"/>
                        </svg>
                        {{ 'help_article.helpful.yes'|trans }}
                        <span class="art-helpful-count" id="countYes">{{ article.helpfulYes }}</span>
                    </button>

                    <button class="art-helpful-btn art-helpful-btn-no" id="btnHelpNo" aria-label="{{ 'help_article.helpful.no_aria'|trans }}">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M10 14H5.236a2 2 0 01-1.789-2.894l3.5-7A2 2 0 018.736 3h4.018a2 2 0 01.485.06l3.76.94m-7 10v5a2 2 0 002 2h.096c.5 0 .905-.405.905-.905 0-.714.211-1.412.608-2.006L17 13V4m-7 10h2m5-10h2a2 2 0 012 2v6a2 2 0 01-2 2h-2.5"/>
                        </svg>
                        {{ 'help_article.helpful.no'|trans }}
                        <span class="art-helpful-count" id="countNo">{{ article.helpfulNo }}</span>
                    </button>
                </div>

                <div class="art-helpful-thank" id="helpfulThank" role="status" aria-live="polite"></div>
            </div>
        </div>

        {# ‚îÄ‚îÄ Right sidebar ‚îÄ‚îÄ #}
        <aside class="art-sidebar" aria-label="{{ 'help_article.sidebar.aria'|trans }}">

            {# Related articles #}
            {% if relatedArticles is not empty %}
                <div class="art-sidebar-card">
                    <div class="art-sidebar-title">
                        <i class="fa-solid fa-book-open" aria-hidden="true"></i>
                        {{ 'help_article.sidebar.related.title'|trans }}
                    </div>

                    <div class="art-related-list">
                        {% for related in relatedArticles %}
                            <a href="{{ path('app_help_article', { categorySlug: category.slug, articleSlug: related.slug }) }}"
                               class="art-related-link">
                                <div class="art-related-dot" aria-hidden="true"></div>
                                <div class="art-related-info">
                                    <div class="art-related-title">{{ related.title }}</div>
                                    <div class="art-related-time">
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                                  d="M12 8v4l3 3m6-3a9 9 0 11-18 0 9 9 0 0118 0z"/>
                                        </svg>
                                        {{ 'help_article.sidebar.related.time_short'|trans({ minutes: related.readTime }) }}
                                    </div>
                                </div>
                            </a>
                        {% endfor %}
                    </div>
                </div>
            {% endif %}

            {# Share #}
            <div class="art-sidebar-card">
                <div class="art-sidebar-title">
                    <i class="fa-solid fa-share-nodes" aria-hidden="true"></i>
                    {{ 'help_article.sidebar.share.title'|trans }}
                </div>

                <div class="art-share-btns">
                    <button class="art-share-btn"
                            id="artShareCopy"
                            title="{{ 'help_article.sidebar.share.copy_title'|trans }}"
                            aria-label="{{ 'help_article.sidebar.share.copy_aria'|trans }}">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M8 16H6a2 2 0 01-2-2V6a2 2 0 012-2h8a2 2 0 012 2v2m-6 12h8a2 2 0 002-2v-8a2 2 0 00-2-2h-8a2 2 0 00-2 2v8a2 2 0 002 2z"/>
                        </svg>
                        {{ 'help_article.sidebar.share.copy'|trans }}
                    </button>

                    <a href="mailto:?subject={{ article.title|url_encode }}&body={{ app.request.uri|url_encode }}"
                       class="art-share-btn"
                       aria-label="{{ 'help_article.sidebar.share.email_aria'|trans }}">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                                  d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8M5 19h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v10a2 2 0 002 2z"/>
                        </svg>
                        {{ 'help_article.sidebar.share.email'|trans }}
                    </a>
                </div>
            </div>

            {# Contact CTA #}
            <div class="art-sidebar-card art-sidebar-cta">
                <div class="art-sidebar-cta-icon" aria-hidden="true">üí¨</div>
                <h3>{{ 'help_article.sidebar.contact.title'|trans }}</h3>
                <p>{{ 'help_article.sidebar.contact.desc'|trans }}</p>
                <a href="mailto:contact@key-nest.com">
                    <svg width="13" height="13" fill="none" stroke="currentColor" viewBox="0 0 24 24" aria-hidden="true">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2"
                              d="M3 8l7.89 5.26a2 2 0 002.22 0L21 8"/>
                    </svg>
                    {{ 'help_article.sidebar.contact.cta'|trans }}
                </a>
            </div>

        </aside>
    </div>

</main>


<script>
(function () {

    /* ‚îÄ‚îÄ Reading progress bar ‚îÄ‚îÄ */
    var bar = document.getElementById('artProgress');
    window.addEventListener('scroll', function () {
        var content = document.getElementById('artContent');
        if (!content) return;
        var rect = content.getBoundingClientRect();
        var total = content.offsetHeight - window.innerHeight;
        var scrolled = -rect.top;
        var pct = Math.min(100, Math.max(0, (scrolled / total) * 100));
        bar.style.width = pct + '%';
        bar.setAttribute('aria-valuenow', Math.round(pct));
    }, { passive: true });

    /* ‚îÄ‚îÄ TOC active link ‚îÄ‚îÄ */
    var tocLinks = document.querySelectorAll('.art-toc-link');
    var sections = Array.from(document.querySelectorAll('.art-section'));

    if (sections.length && tocLinks.length) {
        var observer = new IntersectionObserver(function (entries) {
            entries.forEach(function (entry) {
                if (entry.isIntersecting) {
                    tocLinks.forEach(function (l) { l.classList.remove('active'); });
                    var active = document.querySelector('[data-toc="' + entry.target.id + '"]');
                    if (active) active.classList.add('active');
                }
            });
        }, { rootMargin: '-20% 0px -70% 0px' });

        sections.forEach(function (s) { observer.observe(s); });
    }

    /* ‚îÄ‚îÄ Like / Dislike ‚îÄ‚îÄ */
    var card      = document.getElementById('artHelpfulCard');
    var btnYes    = document.getElementById('btnHelpYes');
    var btnNo     = document.getElementById('btnHelpNo');
    var countYes  = document.getElementById('countYes');
    var countNo   = document.getElementById('countNo');
    var thankMsg  = document.getElementById('helpfulThank');
    var slug      = card ? card.dataset.article : '';
    var storageKey = 'helpful_' + slug;

    // Restore previous vote
    var previousVote = localStorage.getItem(storageKey);
    if (previousVote === 'yes') { btnYes.classList.add('voted-yes'); btnNo.style.opacity = '0.4'; }
    if (previousVote === 'no')  { btnNo.classList.add('voted-no');   btnYes.style.opacity = '0.4'; }

    function vote(type) {
        if (localStorage.getItem(storageKey)) return; // already voted

        var count = parseInt(type === 'yes' ? countYes.textContent : countNo.textContent);
        if (type === 'yes') {
            countYes.textContent = count + 1;
            btnYes.classList.add('voted-yes');
            btnNo.style.opacity = '0.4';
            btnNo.style.pointerEvents = 'none';
            thankMsg.textContent = 'üéâ Merci pour votre retour ! Nous sommes ravis que cet article vous ait aid√©.';
        } else {
            countNo.textContent = count + 1;
            btnNo.classList.add('voted-no');
            btnYes.style.opacity = '0.4';
            btnYes.style.pointerEvents = 'none';
            thankMsg.textContent = 'üìù Merci ! Nous allons am√©liorer cet article. Besoin d\'aide suppl√©mentaire ? Contactez-nous.';
        }

        thankMsg.style.display = 'block';
        localStorage.setItem(storageKey, type);

        // Optional: POST to your API
        // fetch('/api/help/helpful', { method: 'POST', headers: {'Content-Type':'application/json'}, body: JSON.stringify({ slug: slug, vote: type }) });
    }

    if (btnYes) btnYes.addEventListener('click', function () { vote('yes'); });
    if (btnNo)  btnNo.addEventListener('click',  function () { vote('no'); });

    /* ‚îÄ‚îÄ Copy link ‚îÄ‚îÄ */
    var copyBtn = document.getElementById('artShareCopy');
    if (copyBtn) {
        copyBtn.addEventListener('click', function () {
            navigator.clipboard.writeText(window.location.href).then(function () {
                var orig = copyBtn.innerHTML;
                copyBtn.innerHTML = '<svg fill="none" stroke="currentColor" viewBox="0 0 24 24" width="16" height="16"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 13l4 4L19 7"/></svg> Copi√© !';
                copyBtn.style.color = 'var(--color-primary)';
                copyBtn.style.borderColor = 'var(--color-primary)';
                setTimeout(function () {
                    copyBtn.innerHTML = orig;
                    copyBtn.style.color = '';
                    copyBtn.style.borderColor = '';
                }, 2000);
            });
        });
    }

    /* ‚îÄ‚îÄ Smooth scroll for TOC ‚îÄ‚îÄ */
    document.querySelectorAll('.art-toc-link').forEach(function (link) {
        link.addEventListener('click', function (e) {
            e.preventDefault();
            var target = document.getElementById(this.getAttribute('href').slice(1));
            if (target) {
                target.scrollIntoView({ behavior: 'smooth', block: 'start' });
            }
        });
    });

})();
</script>

{% endblock %}
