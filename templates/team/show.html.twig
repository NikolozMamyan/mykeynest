{% extends 'base.html.twig' %}

{% block title %}Équipe {{ team.name }}{% endblock %}

{% block body %}
<div class="team-show-container">
    {# Header #}
    <div class="team-show-header">
        <a href="{{ path('app_team_index') }}" class="btn-back">
            <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M15 19l-7-7 7-7"/>
            </svg>
            Retour aux équipes
        </a>
    </div>

    {# Team Info Card #}
    <div class="team-info-card">
        <div class="team-info-header">
            <div class="team-avatar-large">
                {{ team.name|slice(0, 2)|upper }}
            </div>
            <div class="team-details">
                <h1 class="team-title">{{ team.name }}</h1>
                <div class="team-metadata">
                    <span class="metadata-item">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"/>
                        </svg>
                        Créée le {{ team.createdAt|date('d/m/Y') }}
                    </span>
                    <span class="metadata-item">
                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5.121 17.804A13.937 13.937 0 0112 16c2.5 0 4.847.655 6.879 1.804M15 10a3 3 0 11-6 0 3 3 0 016 0zm6 2a9 9 0 11-18 0 9 9 0 0118 0z"/>
                        </svg>
                        Propriétaire : {{ team.owner.email ?? 'N/A' }}
                    </span>
                </div>
            </div>
        </div>
    </div>

    {# Members Section #}
    <div class="section-card">
        <div class="section-header">
            <div class="section-title">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z"/>
                </svg>
                <h2>Membres de l'équipe</h2>
                <span class="member-count">{{ team.members|length }}</span>
            </div>
        </div>

        {% if team.members is empty %}
            <div class="empty-members">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M17 20h5v-2a3 3 0 00-5.356-1.857M17 20H7m10 0v-2c0-.656-.126-1.283-.356-1.857M7 20H2v-2a3 3 0 015.356-1.857M7 20v-2c0-.656.126-1.283.356-1.857m0 0a5.002 5.002 0 019.288 0M15 7a3 3 0 11-6 0 3 3 0 016 0zm6 3a2 2 0 11-4 0 2 2 0 014 0zM7 10a2 2 0 11-4 0 2 2 0 014 0z"/>
                </svg>
                <p>Aucun membre dans cette équipe</p>
            </div>
        {% else %}
            <div class="members-list">
                {% for member in team.members %}
                    <div class="member-item">
                        <div class="member-avatar">
                            {{ member.user.email|slice(0, 2)|upper }}
                        </div>
                        <div class="member-info">
                            <div class="member-email">{{ member.user.email }}</div>
                            <div class="member-meta">
                                <span class="role-badge role-{{ member.role.value|lower }}">
                                    {% if member.role == constant('App\\Enum\\TeamRole::OWNER') %}
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M5 3v4M3 5h4M6 17v4m-2-2h4m5-16l2.286 6.857L21 12l-5.714 2.143L13 21l-2.286-6.857L5 12l5.714-2.143L13 3z"/>
                                        </svg>
                                    {% elseif member.role == constant('App\\Enum\\TeamRole::ADMIN') %}
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12l2 2 4-4m5.618-4.016A11.955 11.955 0 0112 2.944a11.955 11.955 0 01-8.618 3.04A12.02 12.02 0 003 9c0 5.591 3.824 10.29 9 11.622 5.176-1.332 9-6.03 9-11.622 0-1.042-.133-2.052-.382-3.016z"/>
                                        </svg>
                                    {% else %}
                                        <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M16 7a4 4 0 11-8 0 4 4 0 018 0zM12 14a7 7 0 00-7 7h14a7 7 0 00-7-7z"/>
                                        </svg>
                                    {% endif %}
                                    {{ member.role.value }}
                                </span>
                                <span class="joined-date">
                                    Ajouté le {{ member.joinedAt|date('d/m/Y') }}
                                </span>
                            </div>
                        </div>

                        {% if is_granted('TEAM_MANAGE', team) and member.role != constant('App\\Enum\\TeamRole::OWNER') %}
<form method="post"
                               action="{{ path('app_team_remove_member', {id: team.id, memberId: member.id}) }}"
                               class="remove-member-form"
                               onsubmit="return confirm('Êtes-vous sûr de vouloir supprimer ce membre de l'équipe ?');">
<input type="hidden" name="_token" value="{{ csrf_token('remove_member_' ~ member.id) }}">
<button type="submit" class="btn-remove-member" title="Supprimer ce membre">
<svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 7l-.867 12.142A2 2 0 0116.138 21H7.862a2 2 0 01-1.995-1.858L5 7m5 4v6m4-6v6m1-10V4a1 1 0 00-1-1h-4a1 1 0 00-1 1v3M4 7h16"/>
</svg>
</button>
</form>
{% endif %}
</div>
{% endfor %}
</div>
{% endif %}
</div>
{# Add Member Section #}
{% if add_member_form is defined and add_member_form %}
    <div class="section-card">
        <div class="section-header">
            <div class="section-title">
                <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M18 9v3m0 0v3m0-3h3m-3 0h-3m-2-5a4 4 0 11-8 0 4 4 0 018 0zM3 20a6 6 0 0112 0v1H3v-1z"/>
                </svg>
                <h2>Ajouter un membre</h2>
            </div>
        </div>

        {{ form_start(add_member_form, {'attr': {'class': 'add-member-form'}}) }}
            <div class="form-row">
                <div class="form-group-inline">
                    {{ form_label(add_member_form.email, null, {'label_attr': {'class': 'form-label-inline'}}) }}
                    {{ form_widget(add_member_form.email, {'attr': {'class': 'form-input-inline', 'placeholder': 'email@exemple.com'}}) }}
                    {{ form_errors(add_member_form.email) }}
                </div>
                <div class="form-group-inline">
                    {{ form_label(add_member_form.role, null, {'label_attr': {'class': 'form-label-inline'}}) }}
                    {{ form_widget(add_member_form.role, {'attr': {'class': 'form-select-inline'}}) }}
                    {{ form_errors(add_member_form.role) }}
                </div>
                <button type="submit" class="btn-add-member">
                    <svg fill="none" stroke="currentColor" viewBox="0 0 24 24">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4v16m8-8H4"/>
                    </svg>
                    Ajouter
                </button>
            </div>
        {{ form_end(add_member_form) }}
    </div>
{% endif %}
</div>
<style>
.team-show-container {
    max-width: 900px;
    margin: 0 auto;
    padding: 2rem;
    display: flex;
    flex-direction: column;
    gap: 1.5rem;
}

.team-show-header {
    margin-bottom: 0.5rem;
}

.btn-back {
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--color-text-medium);
    text-decoration: none;
    font-weight: 500;
    transition: all 0.2s ease;
}

.btn-back:hover {
    color: var(--color-primary);
    gap: 0.375rem;
}

.btn-back svg {
    width: 20px;
    height: 20px;
}

/* Team Info Card */
.team-info-card {
    background: var(--background-gradient);
    border-radius: var(--border-radius);
    padding: 2rem;
    box-shadow: var(--shadow-sm);
}

.team-info-header {
    display: flex;
    align-items: center;
    gap: 1.5rem;
}

.team-avatar-large {
    width: 80px;
    height: 80px;
    border-radius: var(--border-radius);
    background: var(--color-primary);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 700;
    font-size: 1.75rem;
    flex-shrink: 0;
    box-shadow: var(--shadow-green);
}

.team-details {
    flex: 1;
}

.team-title {
    font-size: 1.875rem;
    font-weight: 700;
    color: var(--color-text-dark);
    margin: 0 0 0.75rem 0;
}

.team-metadata {
    display: flex;
    flex-wrap: wrap;
    gap: 1.5rem;
}

.metadata-item {
    display: flex;
    align-items: center;
    gap: 0.5rem;
    color: var(--color-text-medium);
    font-size: 0.9375rem;
}

.metadata-item svg {
    width: 18px;
    height: 18px;
    color: var(--color-primary);
}

/* Section Card */
.section-card {
    background: white;
    border-radius: var(--border-radius);
    box-shadow: var(--shadow-sm);
    overflow: hidden;
}

.section-header {
    padding: 1.5rem 2rem;
    border-bottom: 1px solid var(--color-border);
}

.section-title {
    display: flex;
    align-items: center;
    gap: 0.75rem;
}

.section-title svg {
    width: 24px;
    height: 24px;
    color: var(--color-primary);
}

.section-title h2 {
    font-size: 1.25rem;
    font-weight: 600;
    color: var(--color-text-dark);
    margin: 0;
}

.member-count {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    min-width: 28px;
    height: 28px;
    padding: 0 0.5rem;
    background: var(--color-primary);
    color: white;
    border-radius: 14px;
    font-size: 0.875rem;
    font-weight: 600;
}

/* Empty State */
.empty-members {
    text-align: center;
    padding: 3rem 2rem;
}

.empty-members svg {
    width: 48px;
    height: 48px;
    color: var(--color-text-light);
    margin-bottom: 1rem;
}

.empty-members p {
    color: var(--color-text-medium);
    margin: 0;
}

/* Members List */
.members-list {
    padding: 1rem;
}

.member-item {
    display: flex;
    align-items: center;
    gap: 1rem;
    padding: 1rem;
    border-radius: var(--border-radius-sm);
    transition: background 0.2s ease;
}

.member-item:hover {
    background: var(--color-bg-light);
}

.member-avatar {
    width: 48px;
    height: 48px;
    border-radius: 50%;
    background: linear-gradient(135deg, var(--color-primary), #047857);
    color: white;
    display: flex;
    align-items: center;
    justify-content: center;
    font-weight: 600;
    font-size: 1rem;
    flex-shrink: 0;
}

.member-info {
    flex: 1;
    min-width: 0;
}

.member-email {
    font-weight: 600;
    color: var(--color-text-dark);
    margin-bottom: 0.375rem;
}

.member-meta {
    display: flex;
    align-items: center;
    gap: 1rem;
    flex-wrap: wrap;
}

.role-badge {
    display: inline-flex;
    align-items: center;
    gap: 0.375rem;
    padding: 0.25rem 0.75rem;
    border-radius: 12px;
    font-size: 0.8125rem;
    font-weight: 600;
}

.role-badge svg {
    width: 14px;
    height: 14px;
}

.role-owner {
    background: linear-gradient(135deg, #fef3c7, #fde68a);
    color: #92400e;
}

.role-admin {
    background: linear-gradient(135deg, #dbeafe, #bfdbfe);
    color: #1e40af;
}

.role-member {
    background: var(--color-bg-light);
    color: var(--color-text-medium);
}

.joined-date {
    color: var(--color-text-muted);
    font-size: 0.875rem;
}

.remove-member-form {
    margin: 0;
}

.btn-remove-member {
    display: flex;
    align-items: center;
    justify-content: center;
    width: 36px;
    height: 36px;
    background: transparent;
    border: none;
    border-radius: var(--border-radius-sm);
    color: var(--color-text-muted);
    cursor: pointer;
    transition: all 0.2s ease;
}

.btn-remove-member:hover {
    background: #fee2e2;
    color: var(--color-danger-start);
}

.btn-remove-member svg {
    width: 18px;
    height: 18px;
}

/* Add Member Form */
.add-member-form {
    padding: 2rem;
}

.form-row {
    display: grid;
    grid-template-columns: 1fr 1fr auto;
    gap: 1rem;
    align-items: end;
}

.form-group-inline {
    display: flex;
    flex-direction: column;
    gap: 0.5rem;
}

.form-label-inline {
    font-weight: 600;
    color: var(--color-text-dark);
    font-size: 0.875rem;
}

.form-input-inline,
.form-select-inline {
    padding: 0.75rem 1rem;
    border: 1.5px solid var(--color-border);
    border-radius: var(--border-radius-sm);
    font-size: 0.9375rem;
    color: var(--color-text-dark);
    transition: all 0.2s ease;
    background: white;
}

.form-input-inline:focus,
.form-select-inline:focus {
    outline: none;
    border-color: var(--color-primary);
    box-shadow: 0 0 0 3px var(--color-primary-hover);
}

.btn-add-member {
    display: inline-flex;
    align-items: center;
    justify-content: center;
    gap: 0.5rem;
    padding: 0.75rem 1.5rem;
    background: var(--color-primary);
    color: white;
    border: none;
    border-radius: var(--border-radius-sm);
    font-weight: 600;
    font-size: 0.9375rem;
    cursor: pointer;
    transition: all 0.3s ease;
    white-space: nowrap;
}

.btn-add-member:hover {
    background: #047857;
    transform: translateY(-2px);
    box-shadow: var(--shadow-green);
}

.btn-add-member svg {
    width: 18px;
    height: 18px;
}

@media (max-width: 768px) {
    .team-show-container {
        padding: 1rem;
    }

    .team-info-header {
        flex-direction: column;
        text-align: center;
    }

    .team-metadata {
        flex-direction: column;
        align-items: center;
        gap: 0.75rem;
    }

    .form-row {
        grid-template-columns: 1fr;
    }

    .btn-add-member {
        width: 100%;
    }
}
</style>
{% endblock %}